(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const g=[];for(let o=0;o<256;++o)g.push((o+256).toString(16).slice(1));function P(o,e=0){return(g[o[e+0]]+g[o[e+1]]+g[o[e+2]]+g[o[e+3]]+"-"+g[o[e+4]]+g[o[e+5]]+"-"+g[o[e+6]]+g[o[e+7]]+"-"+g[o[e+8]]+g[o[e+9]]+"-"+g[o[e+10]]+g[o[e+11]]+g[o[e+12]]+g[o[e+13]]+g[o[e+14]]+g[o[e+15]]).toLowerCase()}let E;const b=new Uint8Array(16);function O(){if(!E){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");E=crypto.getRandomValues.bind(crypto)}return E(b)}const L=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),w={randomUUID:L};function I(o,e,t){var i;if(w.randomUUID&&!e&&!o)return w.randomUUID();o=o||{};const s=o.random??((i=o.rng)==null?void 0:i.call(o))??O();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let n=0;n<16;++n)e[t+n]=s[n];return e}return P(s)}var d=(o=>(o.SOLDIER="SOLDIER",o.TANK="TANK",o.HELICOPTER="HELICOPTER",o))(d||{}),u=(o=>(o.USA="USA",o.CHINA="CHINA",o.GLA="GLA",o))(u||{}),c=(o=>(o.MONEY="MONEY",o.SUPPLIES="SUPPLIES",o))(c||{});const U={[d.SOLDIER]:{[c.MONEY]:100,[c.SUPPLIES]:50},[d.TANK]:{[c.MONEY]:300,[c.SUPPLIES]:150},[d.HELICOPTER]:{[c.MONEY]:500,[c.SUPPLIES]:200}},C={[d.SOLDIER]:{type:d.SOLDIER,health:100,maxHealth:100,attack:10,defense:5,range:3,speed:2},[d.TANK]:{type:d.TANK,health:300,maxHealth:300,attack:30,defense:20,range:5,speed:1.5},[d.HELICOPTER]:{type:d.HELICOPTER,health:200,maxHealth:200,attack:25,defense:10,range:7,speed:3}},m={respawnTime:30,resourceAmount:{[c.MONEY]:100,[c.SUPPLIES]:75},mapResourceCount:{[c.MONEY]:10,[c.SUPPLIES]:8}};class M{constructor(e,t){this.resourceSpots=[],this.state={players:{},units:{},resources:{},gameTime:0,mapSize:{width:e,height:t}},this.lastUpdateTime=Date.now(),this.generateResourceSpots()}generateResourceSpots(){const{width:e,height:t}=this.state.mapSize,s=m.mapResourceCount[c.MONEY]+m.mapResourceCount[c.SUPPLIES];for(let i=0;i<s;i++){const a={x:Math.random()*(e-200)+100,y:Math.random()*(t-200)+100};this.resourceSpots.push(a)}this.spawnResources()}spawnResources(){const e=m.mapResourceCount[c.MONEY],t=m.mapResourceCount[c.SUPPLIES];for(let s=0;s<e;s++){const i={id:I(),type:c.MONEY,position:this.resourceSpots[s],amount:m.resourceAmount[c.MONEY],respawnTime:m.respawnTime,isCollected:!1};this.state.resources[i.id]=i}for(let s=0;s<t;s++){const i={id:I(),type:c.SUPPLIES,position:this.resourceSpots[s+e],amount:m.resourceAmount[c.SUPPLIES],respawnTime:m.respawnTime,isCollected:!1};this.state.resources[i.id]=i}}getState(){return this.state}addPlayer(e,t){const s=I(),{width:i,height:n}=this.state.mapSize,a={x:Math.random()*(i-200)+100,y:Math.random()*(n-200)+100},r=["#FF5733","#33FF57","#3357FF","#F3FF33","#FF33F3"],l=r[Object.keys(this.state.players).length%r.length],h={id:s,name:e,faction:t,resources:{[c.MONEY]:500,[c.SUPPLIES]:300},units:[],basePosition:a,color:l};return this.state.players[s]=h,this.createUnit(s,d.SOLDIER,{x:a.x-20,y:a.y-20}),this.createUnit(s,d.SOLDIER,{x:a.x+20,y:a.y-20}),this.createUnit(s,d.TANK,{x:a.x,y:a.y+20}),s}createUnit(e,t,s){const i=this.state.players[e];if(!i)return null;const n=1+i.units.length*.1,a={[c.MONEY]:Math.floor(U[t][c.MONEY]*n),[c.SUPPLIES]:Math.floor(U[t][c.SUPPLIES]*n)};if(i.resources[c.MONEY]<a[c.MONEY]||i.resources[c.SUPPLIES]<a[c.SUPPLIES])return null;i.resources[c.MONEY]-=a[c.MONEY],i.resources[c.SUPPLIES]-=a[c.SUPPLIES];const r=I(),l=C[t],h={id:r,...l,position:s,playerId:e,isDead:!1,isMoving:!1,isAttacking:!1};return this.state.units[r]=h,i.units.push(h),r}moveUnit(e,t){const s=this.state.units[e];return!s||s.isDead?!1:(s.path=[t],s.isMoving=!0,s.isAttacking=!1,s.targetId=void 0,!0)}attackUnit(e,t){const s=this.state.units[e],i=this.state.units[t];return!s||!i||s.isDead||i.isDead||s.playerId===i.playerId?!1:(s.targetId=t,s.isAttacking=!0,!0)}update(){const e=Date.now(),t=(e-this.lastUpdateTime)/1e3;this.lastUpdateTime=e,this.state.gameTime+=t,this.updateUnits(t),this.updateResources(t),this.collectResources()}updateUnits(e){Object.values(this.state.units).forEach(t=>{if(!t.isDead){if(t.isMoving&&t.path&&t.path.length>0){const s=t.path[0],i=s.x-t.position.x,n=s.y-t.position.y,a=Math.sqrt(i*i+n*n);if(a<5)t.path.shift(),t.path.length===0&&(t.isMoving=!1);else{const r=t.speed*e*60,l=Math.min(r/a,1);t.position.x+=i*l,t.position.y+=n*l}}if(t.isAttacking&&t.targetId){const s=this.state.units[t.targetId];if(!s||s.isDead){t.isAttacking=!1,t.targetId=void 0;return}const i=s.position.x-t.position.x,n=s.position.y-t.position.y,a=Math.sqrt(i*i+n*n);if(a<=t.range*20){if(Math.floor(this.state.gameTime)>Math.floor(this.state.gameTime-e)){const r=Math.max(1,t.attack-s.defense/2);if(s.health-=r,s.health<=0){s.health=0,s.isDead=!0;const l=this.state.players[s.playerId];l&&(l.units=l.units.filter(h=>h.id!==s.id))}}}else{const r=t.speed*e*60,l=Math.min(r/a,1);t.position.x+=i*l,t.position.y+=n*l}}}})}updateResources(e){Object.values(this.state.resources).forEach(t=>{t.isCollected&&(t.respawnTime-=e,t.respawnTime<=0&&(t.isCollected=!1,t.amount=m.resourceAmount[t.type],t.respawnTime=m.respawnTime))})}collectResources(){Object.values(this.state.resources).forEach(t=>{t.isCollected||Object.values(this.state.players).forEach(s=>{s.units.find(n=>{if(n.isDead)return!1;const a=n.position.x-t.position.x,r=n.position.y-t.position.y;return Math.sqrt(a*a+r*r)<30})&&(s.resources[t.type]+=t.amount,t.isCollected=!0)})})}}const v={[d.SOLDIER]:{width:20,height:20},[d.TANK]:{width:30,height:30},[d.HELICOPTER]:{width:25,height:25}},R={[c.MONEY]:{width:20,height:20},[c.SUPPLIES]:{width:20,height:20}};class A{constructor(e){this.unitImages=new Map,this.resourceImages=new Map,this.debugMode=!1,this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas context");this.ctx=t,this.loadUnitImages(),this.loadResourceImages(),this.baseImage=new Image,this.baseImage.src="/assets/images/base.svg"}loadUnitImages(){Object.values(d).forEach(e=>{const t=new Image;t.src=`/assets/images/${e.toLowerCase()}.svg`,this.unitImages.set(e,t)})}loadResourceImages(){Object.values(c).forEach(e=>{const t=new Image;t.src=`/assets/images/${e.toLowerCase()}.svg`,this.resourceImages.set(e,t)})}setDebugMode(e){this.debugMode=e}render(e){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=e.mapSize.width,this.canvas.height=e.mapSize.height,this.drawBackground(e),this.drawResources(e),this.drawBases(e),this.drawUnits(e),this.debugMode&&this.drawDebugInfo(e)}drawBackground(e){this.ctx.fillStyle="#4a7c59",this.ctx.fillRect(0,0,e.mapSize.width,e.mapSize.height);const t=50;this.ctx.fillStyle="#3d6549";for(let s=0;s<t;s++){const i=Math.random()*e.mapSize.width,n=Math.random()*e.mapSize.height,a=Math.random()*30+10;this.ctx.beginPath(),this.ctx.arc(i,n,a,0,Math.PI*2),this.ctx.fill()}}drawResources(e){Object.values(e.resources).forEach(t=>{if(t.isCollected)return;const s=this.resourceImages.get(t.type);if(!s)return;const i=R[t.type];this.ctx.drawImage(s,t.position.x-i.width/2,t.position.y-i.height/2,i.width,i.height),this.ctx.font="10px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(t.type===c.MONEY?"$":"S",t.position.x,t.position.y-i.height)})}drawBases(e){Object.values(e.players).forEach(t=>{this.ctx.drawImage(this.baseImage,t.basePosition.x-40,t.basePosition.y-40,80,80),this.ctx.font="12px Arial",this.ctx.fillStyle=t.color,this.ctx.textAlign="center",this.ctx.fillText(t.name,t.basePosition.x,t.basePosition.y-50),this.ctx.font="10px Arial",this.ctx.fillText(t.faction,t.basePosition.x,t.basePosition.y-35)})}drawUnits(e){Object.values(e.units).forEach(t=>{if(t.isDead)return;const s=e.players[t.playerId];if(!s)return;const i=this.unitImages.get(t.type);if(!i)return;const n=v[t.type];if(this.ctx.save(),t.isMoving&&t.path&&t.path.length>0){const h=t.path[0],p=Math.atan2(h.y-t.position.y,h.x-t.position.x);this.ctx.translate(t.position.x,t.position.y),this.ctx.rotate(p),this.ctx.translate(-t.position.x,-t.position.y)}else if(t.isAttacking&&t.targetId){const h=e.units[t.targetId];if(h){const p=Math.atan2(h.position.y-t.position.y,h.position.x-t.position.x);this.ctx.translate(t.position.x,t.position.y),this.ctx.rotate(p),this.ctx.translate(-t.position.x,-t.position.y)}}this.ctx.drawImage(i,t.position.x-n.width/2,t.position.y-n.height/2,n.width,n.height),this.ctx.restore();const a=n.width,r=4,l=t.health/t.maxHealth;this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(t.position.x-a/2,t.position.y-n.height/2-8,a,r),this.ctx.fillStyle=l>.5?"green":l>.25?"yellow":"red",this.ctx.fillRect(t.position.x-a/2,t.position.y-n.height/2-8,a*l,r),this.ctx.strokeStyle=s.color,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,n.width/2+2,0,Math.PI*2),this.ctx.stroke(),t.isAttacking?(this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(t.position.x+n.width/2,t.position.y-n.height/2,3,0,Math.PI*2),this.ctx.fill()):t.isMoving&&(this.ctx.fillStyle="blue",this.ctx.beginPath(),this.ctx.arc(t.position.x+n.width/2,t.position.y-n.height/2,3,0,Math.PI*2),this.ctx.fill())})}drawDebugInfo(e){this.ctx.font="12px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="left",this.ctx.fillText(`Game Time: ${e.gameTime.toFixed(2)}s`,10,20);let t=40;Object.values(e.players).forEach(s=>{this.ctx.fillStyle=s.color,this.ctx.fillText(`${s.name}: ${s.units.length} units`,10,t),t+=15;const i=s.units.reduce((n,a)=>(n[a.type]=(n[a.type]||0)+1,n),{});Object.entries(i).forEach(([n,a])=>{this.ctx.fillText(`  ${n}: ${a}`,20,t),t+=15}),this.ctx.fillText(`  Money: ${s.resources[c.MONEY]}`,20,t),t+=15,this.ctx.fillText(`  Supplies: ${s.resources[c.SUPPLIES]}`,20,t),t+=25})}drawSelectionBox(e,t){const s=t.x-e.x,i=t.y-e.y;this.ctx.strokeStyle="white",this.ctx.lineWidth=1,this.ctx.setLineDash([5,3]),this.ctx.strokeRect(e.x,e.y,s,i),this.ctx.setLineDash([])}highlightSelectedUnits(e){e.forEach(t=>{if(t.isDead)return;const s=v[t.type];this.ctx.strokeStyle="white",this.ctx.lineWidth=2,this.ctx.setLineDash([3,2]),this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,s.width/2+5,0,Math.PI*2),this.ctx.stroke(),this.ctx.setLineDash([])})}drawGameOver(e){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="bold 36px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText("Game Over",this.canvas.width/2,this.canvas.height/2-40),this.ctx.font="24px Arial",this.ctx.fillText(`${e} wins!`,this.canvas.width/2,this.canvas.height/2),this.ctx.font="18px Arial",this.ctx.fillText("Click to play again",this.canvas.width/2,this.canvas.height/2+40)}}class D{constructor(e,t,s){this.isMouseDown=!1,this.selectionStart=null,this.selectedUnits=[],this.gameRunning=!0,this.animationFrameId=null,this.canvas=e,this.engine=new M(t,s),this.renderer=new A(e),this.setupEventListeners(),this.playerId=this.engine.addPlayer("Player",u.USA),this.engine.addPlayer("AI 1",u.CHINA),this.engine.addPlayer("AI 2",u.GLA),this.startGameLoop()}getState(){return this.engine.getState()}getPlayerId(){return this.playerId}createUnit(e){if(!this.gameRunning)return;let t;switch(e){case 0:t=d.SOLDIER;break;case 1:t=d.TANK;break;case 2:t=d.HELICOPTER;break;default:return}const i=this.engine.getState().players[this.playerId];if(!i)return;const n=i.basePosition,a=()=>Math.random()*60-30,r={x:n.x+a(),y:n.y+a()};this.engine.createUnit(this.playerId,t,r)}setupEventListeners(){this.canvas.addEventListener("mousedown",e=>{if(!this.gameRunning)return;const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.isMouseDown=!0,this.selectionStart={x:s,y:i},e.shiftKey||(this.selectedUnits=[])}),this.canvas.addEventListener("mousemove",e=>{if(!this.gameRunning||!this.isMouseDown||!this.selectionStart)return;const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.renderGameWithSelectionBox({x:s,y:i})}),this.canvas.addEventListener("mouseup",e=>{if(!this.gameRunning){this.restartGame();return}const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.isMouseDown&&this.selectionStart&&(Math.abs(s-this.selectionStart.x)>5||Math.abs(i-this.selectionStart.y)>5?this.selectUnitsInBox(this.selectionStart,{x:s,y:i}):this.handleSingleClick({x:s,y:i},e.shiftKey)),this.isMouseDown=!1,this.selectionStart=null}),this.canvas.addEventListener("contextmenu",e=>{if(e.preventDefault(),!this.gameRunning||this.selectedUnits.length===0)return;const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.issueCommand({x:s,y:i})}),window.addEventListener("keydown",e=>{if(this.gameRunning)switch(e.key){case"Escape":this.selectedUnits=[];break;case"1":case"2":case"3":this.createUnit(parseInt(e.key)-1);break;case"d":this.renderer.setDebugMode(!0);break}}),window.addEventListener("keyup",e=>{e.key==="d"&&this.renderer.setDebugMode(!1)})}startGameLoop(){const e=()=>{this.gameRunning&&(this.engine.update(),this.renderer.render(this.engine.getState()),this.renderer.highlightSelectedUnits(this.selectedUnits),this.checkGameOver(),this.animationFrameId=requestAnimationFrame(e))};this.animationFrameId=requestAnimationFrame(e)}renderGameWithSelectionBox(e){this.selectionStart&&(this.renderer.render(this.engine.getState()),this.renderer.drawSelectionBox(this.selectionStart,e),this.renderer.highlightSelectedUnits(this.selectedUnits))}handleSingleClick(e,t){const s=this.engine.getState();let i=null;if(Object.values(s.units).forEach(n=>{if(n.isDead)return;const a=e.x-n.position.x,r=e.y-n.position.y,l=Math.sqrt(a*a+r*r),h=n.type===d.TANK?15:10;l<=h&&(i=n)}),i){const n=i;n.playerId===this.playerId?t?this.selectedUnits.some(a=>a.id===n.id)||this.selectedUnits.push(n):this.selectedUnits=[n]:this.selectedUnits.length>0&&this.selectedUnits.forEach(a=>{this.engine.attackUnit(a.id,n.id)})}else t||(this.selectedUnits=[])}selectUnitsInBox(e,t){const s=this.engine.getState(),i=Math.min(e.x,t.x),n=Math.max(e.x,t.x),a=Math.min(e.y,t.y),r=Math.max(e.y,t.y);Object.values(s.units).filter(h=>h.isDead||h.playerId!==this.playerId?!1:h.position.x>=i&&h.position.x<=n&&h.position.y>=a&&h.position.y<=r).forEach(h=>{this.selectedUnits.some(p=>p.id===h.id)||this.selectedUnits.push(h)})}issueCommand(e){const t=this.engine.getState();let s=null;if(Object.values(t.units).forEach(i=>{if(i.isDead||i.playerId===this.playerId)return;const n=e.x-i.position.x,a=e.y-i.position.y,r=Math.sqrt(n*n+a*a),l=i.type===d.TANK?15:10;r<=l&&(s=i)}),s)this.selectedUnits.forEach(i=>{this.engine.attackUnit(i.id,s.id)});else{const i=this.selectedUnits.length,n=Math.ceil(Math.sqrt(i)),a=30;this.selectedUnits.forEach((r,l)=>{const h=Math.floor(l/n),y=(l%n-n/2)*a,S=(h-n/2)*a,x={x:e.x+y,y:e.y+S};this.engine.moveUnit(r.id,x)})}}checkGameOver(){const e=this.engine.getState(),t=Object.values(e.players).filter(s=>s.units.length>0||s.resources[c.MONEY]>=100&&s.resources[c.SUPPLIES]>=50);if(t.length<=1){this.gameRunning=!1;const s=t.length===1?t[0].name:"Nobody";this.renderer.drawGameOver(s),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}restartGame(){this.engine=new M(this.canvas.width,this.canvas.height),this.selectedUnits=[],this.gameRunning=!0,this.playerId=this.engine.addPlayer("Player",u.USA),this.engine.addPlayer("AI 1",u.CHINA),this.engine.addPlayer("AI 2",u.GLA),this.startGameLoop()}}document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("gameCanvas");if(!o){console.error("Canvas element not found");return}o.width=900,o.height=600;const e=new D(o,900,600),t=document.getElementById("soldier-btn"),s=document.getElementById("tank-btn"),i=document.getElementById("helicopter-btn");t&&t.addEventListener("click",()=>{e.createUnit(0)}),s&&s.addEventListener("click",()=>{e.createUnit(1)}),i&&i.addEventListener("click",()=>{e.createUnit(2)}),setInterval(()=>{const n=e.getState();if(!n||!n.players)return;const a=Object.values(n.players).find(x=>x.id===e.getPlayerId());if(!a)return;const r=document.getElementById("money");r&&(r.textContent=a.resources[c.MONEY].toString());const l=document.getElementById("supplies");l&&(l.textContent=a.resources[c.SUPPLIES].toString());const h=a.units.length,p=document.getElementById("soldier-cost"),y=document.getElementById("tank-cost"),S=document.getElementById("helicopter-cost");if(p){const f=Math.floor(100*(1+h*.05));p.textContent=f.toString()}if(y){const f=Math.floor(300*(1+h*.05));y.textContent=f.toString()}if(S){const f=Math.floor(500*(1+h*.05));S.textContent=f.toString()}},1e3)});
//# sourceMappingURL=index-ad0baf4f.js.map
