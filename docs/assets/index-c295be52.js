(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const g=[];for(let o=0;o<256;++o)g.push((o+256).toString(16).slice(1));function O(o,e=0){return(g[o[e+0]]+g[o[e+1]]+g[o[e+2]]+g[o[e+3]]+"-"+g[o[e+4]]+g[o[e+5]]+"-"+g[o[e+6]]+g[o[e+7]]+"-"+g[o[e+8]]+g[o[e+9]]+"-"+g[o[e+10]]+g[o[e+11]]+g[o[e+12]]+g[o[e+13]]+g[o[e+14]]+g[o[e+15]]).toLowerCase()}let I;const b=new Uint8Array(16);function A(){if(!I){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");I=crypto.getRandomValues.bind(crypto)}return I(b)}const U=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),w={randomUUID:U};function E(o,e,t){var i;if(w.randomUUID&&!e&&!o)return w.randomUUID();o=o||{};const s=o.random??((i=o.rng)==null?void 0:i.call(o))??A();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let n=0;n<16;++n)e[t+n]=s[n];return e}return O(s)}var l=(o=>(o.SOLDIER="SOLDIER",o.TANK="TANK",o.HELICOPTER="HELICOPTER",o))(l||{}),p=(o=>(o.USA="USA",o.CHINA="CHINA",o.GLA="GLA",o))(p||{}),h=(o=>(o.MONEY="MONEY",o))(h||{});const R={[l.SOLDIER]:{[h.MONEY]:150},[l.TANK]:{[h.MONEY]:450},[l.HELICOPTER]:{[h.MONEY]:700}},k={[l.SOLDIER]:{type:l.SOLDIER,health:100,maxHealth:100,attack:10,defense:5,range:3,speed:2,canAttackAir:!0,canAttackGround:!0},[l.TANK]:{type:l.TANK,health:300,maxHealth:300,attack:30,defense:20,range:5,speed:1.5,canAttackAir:!1,canAttackGround:!0},[l.HELICOPTER]:{type:l.HELICOPTER,health:200,maxHealth:200,attack:25,defense:10,range:7,speed:3,canAttackAir:!0,canAttackGround:!0}},x={respawnTime:30,resourceAmount:{[h.MONEY]:150},mapResourceCount:{[h.MONEY]:15}};class M{constructor(e,t){this.resourceSpots=[],this.state={players:{},units:{},resources:{},gameTime:0,mapSize:{width:e,height:t}},this.lastUpdateTime=Date.now(),this.generateResourceSpots()}generateResourceSpots(){const{width:e,height:t}=this.state.mapSize,s=x.mapResourceCount[h.MONEY];for(let i=0;i<s;i++){const a={x:Math.random()*(e-200)+100,y:Math.random()*(t-200)+100};this.resourceSpots.push(a)}this.spawnResources()}spawnResources(){const e=x.mapResourceCount[h.MONEY];for(let t=0;t<e;t++){const s={id:E(),type:h.MONEY,position:this.resourceSpots[t],amount:x.resourceAmount[h.MONEY],respawnTime:x.respawnTime,isCollected:!1};this.state.resources[s.id]=s}}getState(){return this.state}addPlayer(e,t){const s=E(),{width:i,height:n}=this.state.mapSize,a={x:Math.random()*(i-200)+100,y:Math.random()*(n-200)+100},r=["#FF5733","#33FF57","#3357FF","#F3FF33","#FF33F3"],d=r[Object.keys(this.state.players).length%r.length],c={id:s,name:e,faction:t,resources:{[h.MONEY]:800},units:[],basePosition:a,color:d};return this.state.players[s]=c,this.createUnit(s,l.SOLDIER,{x:a.x-20,y:a.y-20}),this.createUnit(s,l.SOLDIER,{x:a.x+20,y:a.y-20}),this.createUnit(s,l.TANK,{x:a.x,y:a.y+20}),s}createUnit(e,t,s){const i=this.state.players[e];if(!i)return null;const n=1+i.units.length*.1,a={[h.MONEY]:Math.floor(R[t][h.MONEY]*n)};if(i.resources[h.MONEY]<a[h.MONEY])return null;i.resources[h.MONEY]-=a[h.MONEY];const r=E(),d=k[t],c={id:r,...d,position:s,playerId:e,isDead:!1,isMoving:!1,isAttacking:!1};return this.state.units[r]=c,i.units.push(c),r}moveUnit(e,t){const s=this.state.units[e];return!s||s.isDead?!1:(s.path=[t],s.isMoving=!0,s.isAttacking=!1,s.targetId=void 0,!0)}attackUnit(e,t){const s=this.state.units[e],i=this.state.units[t];return!s||!i||s.isDead||i.isDead||s.playerId===i.playerId||!this.canUnitAttackTarget(s,i)?!1:(s.targetId=t,s.isAttacking=!0,!0)}update(){const e=Date.now(),t=(e-this.lastUpdateTime)/1e3;this.lastUpdateTime=e,this.state.gameTime+=t,this.updateUnits(t),this.updateResources(t),this.collectResources()}updateUnits(e){Object.values(this.state.units).forEach(t=>{if(!t.isDead){if(this.checkForAutoTarget(t),t.isMoving&&t.path&&t.path.length>0){const s=t.path[0],i=s.x-t.position.x,n=s.y-t.position.y,a=Math.sqrt(i*i+n*n);if(a<1)t.path.shift(),t.path.length===0&&(t.isMoving=!1);else{const r=t.speed*e*60,d=Math.min(r/a,1);t.position.x+=i*d,t.position.y+=n*d}}if(t.isAttacking&&t.targetId){const s=this.state.units[t.targetId];if(!s||s.isDead){t.isAttacking=!1,t.targetId=void 0;return}if(!this.canUnitAttackTarget(t,s)){t.isAttacking=!1,t.targetId=void 0;return}const n=s.position.x-t.position.x,a=s.position.y-t.position.y,r=Math.sqrt(n*n+a*a);if(r<=t.range*20){if(Math.floor(this.state.gameTime)>Math.floor(this.state.gameTime-e)){const d=Math.max(1,t.attack-s.defense/2);if(s.health-=d,s.health<=0){s.health=0,s.isDead=!0;const c=this.state.players[s.playerId];c&&(c.units=c.units.filter(m=>m.id!==s.id))}}}else{const d=t.speed*e*60,c=Math.min(d/r,1);t.position.x+=n*c,t.position.y+=a*c}}}})}checkForAutoTarget(e){if(e.isAttacking||e.isMoving&&!e.isAttacking)return;let t=null,s=1/0;Object.values(this.state.units).forEach(i=>{if(i.isDead||i.playerId===e.playerId||!this.canUnitAttackTarget(e,i))return;const n=i.position.x-e.position.x,a=i.position.y-e.position.y,r=Math.sqrt(n*n+a*a),d=e.range*25;r<=d&&r<s&&(t=i,s=r)}),t&&this.attackUnit(e.id,t.id)}canUnitAttackTarget(e,t){return t.type===l.HELICOPTER?e.canAttackAir:e.canAttackGround}updateResources(e){Object.values(this.state.resources).forEach(t=>{t.isCollected&&(t.respawnTime-=e,t.respawnTime<=0&&(t.isCollected=!1,t.amount=x.resourceAmount[t.type],t.respawnTime=x.respawnTime))})}collectResources(){Object.values(this.state.resources).forEach(t=>{t.isCollected||Object.values(this.state.players).forEach(s=>{s.units.find(n=>{if(n.isDead||n.type!==l.SOLDIER)return!1;const a=n.position.x-t.position.x,r=n.position.y-t.position.y;return Math.sqrt(a*a+r*r)<30})&&(s.resources[h.MONEY]+=t.amount,t.isCollected=!0)})})}checkGameOver(){const e=this.getState();Object.values(e.players).filter(t=>t.units.length>0||t.resources[h.MONEY]>=150)}}const v={[l.SOLDIER]:{width:20,height:20},[l.TANK]:{width:30,height:30},[l.HELICOPTER]:{width:25,height:25}},C={[h.MONEY]:{width:20,height:20}};class T{constructor(e){this.unitImages=new Map,this.resourceImages=new Map,this.debugMode=!1,this.canvas=e;const t=e.getContext("2d");if(!t)throw new Error("Failed to get canvas context");this.ctx=t,this.loadUnitImages(),this.loadResourceImages(),this.baseImage=new Image,this.baseImage.src="/mini_generals/assets/images/base.svg"}loadUnitImages(){Object.values(l).forEach(e=>{const t=new Image;t.src=`/mini_generals/assets/images/${e.toLowerCase()}.svg`,this.unitImages.set(e,t)})}loadResourceImages(){const e=new Image;e.src=`/mini_generals/assets/images/${h.MONEY.toLowerCase()}.svg`,this.resourceImages.set(h.MONEY,e)}setDebugMode(e){this.debugMode=e}render(e){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=e.mapSize.width,this.canvas.height=e.mapSize.height,this.drawBackground(e),this.drawResources(e),this.drawBases(e),this.drawUnits(e),this.debugMode&&this.drawDebugInfo(e)}drawBackground(e){this.ctx.fillStyle="#4a7c59",this.ctx.fillRect(0,0,e.mapSize.width,e.mapSize.height);const t=50;this.ctx.fillStyle="#3d6549";for(let s=0;s<t;s++){const i=Math.random()*e.mapSize.width,n=Math.random()*e.mapSize.height,a=Math.random()*30+10;this.ctx.beginPath(),this.ctx.arc(i,n,a,0,Math.PI*2),this.ctx.fill()}}drawResources(e){Object.values(e.resources).forEach(t=>{if(t.isCollected)return;const s=this.resourceImages.get(t.type);if(!s)return;const i=C[t.type];this.ctx.drawImage(s,t.position.x-i.width/2,t.position.y-i.height/2,i.width,i.height),this.ctx.font="10px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(t.type===h.MONEY?"$":"S",t.position.x,t.position.y-i.height)})}drawBases(e){Object.values(e.players).forEach(t=>{this.ctx.drawImage(this.baseImage,t.basePosition.x-40,t.basePosition.y-40,80,80),this.ctx.font="12px Arial",this.ctx.fillStyle=t.color,this.ctx.textAlign="center",this.ctx.fillText(t.name,t.basePosition.x,t.basePosition.y-50),this.ctx.font="10px Arial",this.ctx.fillText(t.faction,t.basePosition.x,t.basePosition.y-35)})}drawUnits(e){this.drawAttackLines(e),Object.values(e.units).forEach(t=>{if(t.isDead)return;const s=e.players[t.playerId];if(!s)return;const i=this.unitImages.get(t.type);if(!i)return;const n=v[t.type];if(this.ctx.save(),t.isMoving&&t.path&&t.path.length>0){const c=t.path[0],m=Math.atan2(c.y-t.position.y,c.x-t.position.x);this.ctx.translate(t.position.x,t.position.y),this.ctx.rotate(m),this.ctx.translate(-t.position.x,-t.position.y)}else if(t.isAttacking&&t.targetId){const c=e.units[t.targetId];if(c){const m=Math.atan2(c.position.y-t.position.y,c.position.x-t.position.x);this.ctx.translate(t.position.x,t.position.y),this.ctx.rotate(m),this.ctx.translate(-t.position.x,-t.position.y)}}this.ctx.drawImage(i,t.position.x-n.width/2,t.position.y-n.height/2,n.width,n.height),this.ctx.restore();const a=n.width,r=4,d=t.health/t.maxHealth;this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(t.position.x-a/2,t.position.y-n.height/2-8,a,r),this.ctx.fillStyle=d>.5?"green":d>.25?"yellow":"red",this.ctx.fillRect(t.position.x-a/2,t.position.y-n.height/2-8,a*d,r),this.ctx.strokeStyle=s.color,this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,n.width/2+2,0,Math.PI*2),this.ctx.stroke(),t.isAttacking?(this.ctx.fillStyle="red",this.ctx.beginPath(),this.ctx.arc(t.position.x+n.width/2,t.position.y-n.height/2,3,0,Math.PI*2),this.ctx.fill()):t.isMoving&&(this.ctx.fillStyle="blue",this.ctx.beginPath(),this.ctx.arc(t.position.x+n.width/2,t.position.y-n.height/2,3,0,Math.PI*2),this.ctx.fill())})}drawAttackLines(e){Object.values(e.units).forEach(t=>{if(t.isDead||!t.isAttacking||!t.targetId)return;const s=e.units[t.targetId];!s||s.isDead||(this.ctx.beginPath(),this.ctx.moveTo(t.position.x,t.position.y),this.ctx.lineTo(s.position.x,s.position.y),t.type===l.SOLDIER?(this.ctx.strokeStyle="rgba(255, 255, 0, 0.5)",this.ctx.lineWidth=1):t.type===l.TANK?(this.ctx.strokeStyle="rgba(255, 0, 0, 0.5)",this.ctx.lineWidth=2):t.type===l.HELICOPTER&&(this.ctx.strokeStyle="rgba(0, 255, 255, 0.5)",this.ctx.lineWidth=1.5),this.ctx.stroke(),Math.random()<.2&&(this.ctx.beginPath(),this.ctx.arc(s.position.x,s.position.y,5,0,Math.PI*2),this.ctx.fillStyle="rgba(255, 100, 0, 0.7)",this.ctx.fill()))})}drawDebugInfo(e){this.ctx.font="12px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="left",this.ctx.fillText(`Game Time: ${e.gameTime.toFixed(2)}s`,10,20);let t=40;Object.values(e.players).forEach(s=>{this.ctx.fillStyle=s.color,this.ctx.fillText(`${s.name}: ${s.units.length} units`,10,t),t+=15;const i=s.units.reduce((n,a)=>(n[a.type]=(n[a.type]||0)+1,n),{});Object.entries(i).forEach(([n,a])=>{this.ctx.fillText(`  ${n}: ${a}`,20,t),t+=15}),this.ctx.fillText(`  Money: ${s.resources[h.MONEY]}`,20,t),t+=25})}drawSelectionBox(e,t){const s=t.x-e.x,i=t.y-e.y;this.ctx.strokeStyle="white",this.ctx.lineWidth=1,this.ctx.setLineDash([5,3]),this.ctx.strokeRect(e.x,e.y,s,i),this.ctx.setLineDash([])}highlightSelectedUnits(e){e.forEach(t=>{if(t.isDead)return;const s=v[t.type];this.ctx.strokeStyle="white",this.ctx.lineWidth=2,this.ctx.setLineDash([3,2]),this.ctx.beginPath(),this.ctx.arc(t.position.x,t.position.y,s.width/2+5,0,Math.PI*2),this.ctx.stroke(),this.ctx.setLineDash([])})}drawGameOver(e){this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font="bold 36px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText("Game Over",this.canvas.width/2,this.canvas.height/2-40),this.ctx.font="24px Arial",this.ctx.fillText(`${e} wins!`,this.canvas.width/2,this.canvas.height/2),this.ctx.font="18px Arial",this.ctx.fillText("Click to play again",this.canvas.width/2,this.canvas.height/2+40)}}class D{constructor(e,t,s){this.isMouseDown=!1,this.selectionStart=null,this.selectedUnits=[],this.gameRunning=!0,this.animationFrameId=null,this.canvas=e,this.engine=new M(t,s),this.renderer=new T(e),this.setupEventListeners(),this.playerId=this.engine.addPlayer("Player",p.USA),this.engine.addPlayer("AI 1",p.CHINA),this.engine.addPlayer("AI 2",p.GLA),this.startGameLoop()}getState(){return this.engine.getState()}getPlayerId(){return this.playerId}createUnit(e){if(!this.gameRunning)return;let t;switch(e){case 0:t=l.SOLDIER;break;case 1:t=l.TANK;break;case 2:t=l.HELICOPTER;break;default:return}const i=this.engine.getState().players[this.playerId];if(!i)return;const n=i.basePosition,a=()=>Math.random()*60-30,r={x:n.x+a(),y:n.y+a()};this.engine.createUnit(this.playerId,t,r)}setupEventListeners(){this.canvas.addEventListener("mousedown",e=>{if(!this.gameRunning)return;e.preventDefault();const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.isMouseDown=!0,this.selectionStart={x:s,y:i},e.shiftKey||(this.selectedUnits=[])}),this.canvas.addEventListener("mousemove",e=>{if(!this.gameRunning||!this.isMouseDown||!this.selectionStart)return;e.preventDefault();const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.renderGameWithSelectionBox({x:s,y:i})}),this.canvas.addEventListener("mouseup",e=>{if(!this.gameRunning){this.restartGame();return}const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.isMouseDown&&this.selectionStart&&(Math.abs(s-this.selectionStart.x)>5||Math.abs(i-this.selectionStart.y)>5?this.selectUnitsInBox(this.selectionStart,{x:s,y:i}):this.handleSingleClick({x:s,y:i},e.shiftKey)),this.isMouseDown=!1,this.selectionStart=null}),this.canvas.addEventListener("contextmenu",e=>{if(e.preventDefault(),!this.gameRunning||this.selectedUnits.length===0)return;const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;this.moveSelectedUnitsTo({x:s,y:i})}),window.addEventListener("keydown",e=>{if(this.gameRunning)switch(e.key){case"Escape":this.selectedUnits=[];break;case"1":case"2":case"3":this.createUnit(parseInt(e.key)-1);break;case"d":this.renderer.setDebugMode(!0);break}}),window.addEventListener("keyup",e=>{e.key==="d"&&this.renderer.setDebugMode(!1)})}startGameLoop(){const e=()=>{this.gameRunning&&(this.engine.update(),this.renderer.render(this.engine.getState()),this.renderer.highlightSelectedUnits(this.selectedUnits),this.checkGameOver(),this.animationFrameId=requestAnimationFrame(e))};this.animationFrameId=requestAnimationFrame(e)}renderGameWithSelectionBox(e){this.selectionStart&&(this.renderer.render(this.engine.getState()),this.renderer.drawSelectionBox(this.selectionStart,e),this.renderer.highlightSelectedUnits(this.selectedUnits))}handleSingleClick(e,t){const s=this.engine.getState();let i=null;if(Object.values(s.units).forEach(n=>{if(n.isDead)return;const a=e.x-n.position.x,r=e.y-n.position.y,d=Math.sqrt(a*a+r*r),c=n.type===l.TANK?15:10;d<=c&&(i=n)}),i){const n=i;n.playerId===this.playerId?t?this.selectedUnits.some(a=>a.id===n.id)||this.selectedUnits.push(n):this.selectedUnits=[n]:this.selectedUnits.length>0&&this.selectedUnits.forEach(a=>{this.engine.attackUnit(a.id,n.id)})}else this.selectedUnits.length>0?this.moveSelectedUnitsTo(e):t||(this.selectedUnits=[])}moveSelectedUnitsTo(e){const t=this.selectedUnits.length,s=Math.ceil(Math.sqrt(t)),i=30;this.selectedUnits.forEach((n,a)=>{const r=Math.floor(a/s),c=(a%s-s/2)*i,m=(r-s/2)*i,u={x:e.x+c,y:e.y+m};this.engine.moveUnit(n.id,u)})}selectUnitsInBox(e,t){const s=this.engine.getState(),i=Math.min(e.x,t.x),n=Math.max(e.x,t.x),a=Math.min(e.y,t.y),r=Math.max(e.y,t.y);Object.values(s.units).filter(c=>c.isDead||c.playerId!==this.playerId?!1:c.position.x>=i&&c.position.x<=n&&c.position.y>=a&&c.position.y<=r).forEach(c=>{this.selectedUnits.some(m=>m.id===c.id)||this.selectedUnits.push(c)})}issueCommand(e){const t=this.engine.getState();let s=null;Object.values(t.units).forEach(i=>{if(i.isDead||i.playerId===this.playerId)return;const n=e.x-i.position.x,a=e.y-i.position.y,r=Math.sqrt(n*n+a*a),d=i.type===l.TANK?15:10;r<=d&&(s=i)}),s?this.selectedUnits.forEach(i=>{this.engine.attackUnit(i.id,s.id)}):this.moveSelectedUnitsTo(e)}checkGameOver(){const e=this.engine.getState(),t=Object.values(e.players).filter(s=>s.units.length>0||s.resources[h.MONEY]>=150);if(t.length<=1){this.gameRunning=!1;const s=t.length===1?t[0].name:"Nobody";this.renderer.drawGameOver(s),this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}restartGame(){this.engine=new M(this.canvas.width,this.canvas.height),this.selectedUnits=[],this.gameRunning=!0,this.playerId=this.engine.addPlayer("Player",p.USA),this.engine.addPlayer("AI 1",p.CHINA),this.engine.addPlayer("AI 2",p.GLA),this.startGameLoop()}}document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("gameCanvas");if(!o){console.error("Canvas element not found");return}o.width=900,o.height=600;const e=new D(o,900,600),t=document.getElementById("soldier-btn"),s=document.getElementById("tank-btn"),i=document.getElementById("helicopter-btn");t&&t.addEventListener("click",()=>{e.createUnit(0)}),s&&s.addEventListener("click",()=>{e.createUnit(1)}),i&&i.addEventListener("click",()=>{e.createUnit(2)}),setInterval(()=>{const n=e.getState();if(!n||!n.players)return;const a=Object.values(n.players).find(y=>y.id===e.getPlayerId());if(!a)return;const r=document.getElementById("money");r&&(r.textContent=a.resources[h.MONEY].toString());const d=document.getElementById("supplies");d&&(d.textContent=a.resources[h.SUPPLIES].toString());const c=a.units.length,m=document.getElementById("soldier-cost"),u=document.getElementById("tank-cost"),S=document.getElementById("helicopter-cost");if(m){const f=Math.floor(100*(1+c*.05));m.textContent=f.toString()}if(u){const f=Math.floor(300*(1+c*.05));u.textContent=f.toString()}if(S){const f=Math.floor(500*(1+c*.05));S.textContent=f.toString()}},1e3)});
//# sourceMappingURL=index-c295be52.js.map
